
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Using JSOM (CSOM, SharePoint Client Side Object Model) in Node.js</title>
    <meta name="description" content="">

    <meta name="google-site-verification" content="kj4x9HBApwneuGIIlFZj11VGEQnPG5Mp21U2n_mSCcU">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/assets/images/favicon.ico?v=7b8d2b4800">

    <link rel="stylesheet" type="text/css" href="/assets/css/arvo-bundle.css?v=7b8d2b4800">
    <link rel="stylesheet" type="text/css" href="/assets/css/prism.css?v=7b8d2b4800">
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=7b8d2b4800">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="ARVO Systems Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Using JSOM (CSOM, SharePoint Client Side Object Model) in Node.js">
    <meta property="og:description" content="Intro It's not a secret that it's theoretically feasible to execute SharePoint Client Side Object Model in Node.js. Some folks found a way to master JSOM in Node.js's context around 5 years ago from now. Unfortunately, there was no solid solution as a drop-in library. And you could">
    <meta property="og:url" content="/2017/06/05/using-jsom-csom-sharepoint-client-side-object-model-in-node-js/">
    <meta property="og:image" content="/content/images/2017/06/JsomNodeWide-1.png">
    <meta property="article:published_time" content="2017-06-05T07:07:56.000Z">
    <meta property="article:modified_time" content="2017-06-05T07:10:43.000Z">
    <meta property="article:tag" content="SharePoint">
    <meta property="article:tag" content="Node.js">
    <meta property="article:tag" content="JSOM">
    <meta property="article:tag" content="API">
    <meta property="article:tag" content="TypeScript">
    <meta property="article:tag" content="JavaScript">
    
    <meta property="article:author" content="https://www.facebook.com/andrew.koltyakov">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Using JSOM (CSOM, SharePoint Client Side Object Model) in Node.js">
    <meta name="twitter:description" content="Intro It's not a secret that it's theoretically feasible to execute SharePoint Client Side Object Model in Node.js. Some folks found a way to master JSOM in Node.js's context around 5 years ago from now. Unfortunately, there was no solid solution as a drop-in library. And you could">
    <meta name="twitter:url" content="/2017/06/05/using-jsom-csom-sharepoint-client-side-object-model-in-node-js/">
    <meta name="twitter:image" content="/content/images/2017/06/JsomNodeWide-1.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Andrew Koltyakov">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="SharePoint, Node.js, JSOM, API, TypeScript, JavaScript">
    <meta name="twitter:creator" content="@AndrewKoltyakov">
    <meta property="og:image:width" content="3709">
    <meta property="og:image:height" content="922">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "ARVO Systems Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "/content/images/2016/09/arvo_logo_105px.png",
            "width": 105,
            "height": 42
        }
    },
    "author": {
        "@type": "Person",
        "name": "Andrew Koltyakov",
        "image": {
            "@type": "ImageObject",
            "url": "/content/images/2016/09/andrew.koltyakov.jpg",
            "width": 460,
            "height": 460
        },
        "url": "/author/andrew/",
        "sameAs": [
            "http://koltyakov.ru",
            "https://www.facebook.com/andrew.koltyakov",
            "https://twitter.com/AndrewKoltyakov"
        ],
        "description": "SharePoint Front-End Developer"
    },
    "headline": "Using JSOM (CSOM, SharePoint Client Side Object Model) in Node.js",
    "url": "/2017/06/05/using-jsom-csom-sharepoint-client-side-object-model-in-node-js/",
    "datePublished": "2017-06-05T07:07:56.000Z",
    "dateModified": "2017-06-05T07:10:43.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "/content/images/2017/06/JsomNodeWide-1.png",
        "width": 3709,
        "height": 922
    },
    "keywords": "SharePoint, Node.js, JSOM, API, TypeScript, JavaScript",
    "description": "Intro It&#x27;s not a secret that it&#x27;s theoretically feasible to execute SharePoint Client Side Object Model in Node.js. Some folks found a way to master JSOM in Node.js&#x27;s context around 5 years ago from now. Unfortunately, there was no solid solution as a drop-in library. And you could",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://external.arvosys.com:2368"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.10">
    <link rel="alternate" type="application/rss+xml" title="ARVO Systems Blog" href="../../../../rss/index.html">
</head>
<body class="post-template tag-sharepoint tag-node-js tag-jsom tag-api tag-typescript tag-javascript nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-blog-home" role="presentation"><a href="../../../../">Blog Home</a></li>
            <li class="nav-search" role="presentation"><a href="http://www.arvosys.com/search/">Search</a></li>
            <li class="nav-arvo-systems" role="presentation"><a href="http://www.arvosys.com/">ARVO Systems</a></li>
            <li class="nav--services" role="presentation"><a href="http://www.arvosys.com/services/">... Services</a></li>
            <li class="nav--platforms" role="presentation"><a href="http://www.arvosys.com/platforms/">... Platforms</a></li>
            <li class="nav--contacts" role="presentation"><a href="http://www.arvosys.com/about/contacts/">... Contacts</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="../../../../rss/index.rss">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">
        <div id="content-wrapper" class="page-content">

            


<header class="main-header post-head " style="background-image: url(../../../../content/images/2017/06/JsomNodeWide-1.png)">
    <nav class="main-nav overlay clearfix">
        <a class="blog-logo" href="../../../../"><img src="../../../../content/images/2016/09/arvo_logo_105px.png" alt="ARVO Systems Blog"></a>
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-sharepoint tag-node-js tag-jsom tag-api tag-typescript tag-javascript">

        <header class="post-header">
            <h1 class="post-title">Using JSOM (CSOM, SharePoint Client Side Object Model) in Node.js</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-06-05">05 June 2017</time>  on <a href="../../../../tag/sharepoint/">SharePoint</a>, <a href="../../../../tag/node-js/">Node.js</a>, <a href="../../../../tag/jsom/">JSOM</a>, <a href="../../../../tag/api/">API</a>, <a href="../../../../tag/typescript/">TypeScript</a>, <a href="../../../../tag/javascript/">JavaScript</a>
            </section>
        </header>

        <section class="post-content">
            <h2 id="intro">Intro</h2>

<p>It's not a secret that it's theoretically feasible to execute SharePoint Client Side Object Model in Node.js. Some folks found a way to master <a href="https://gist.github.com/lstak/2404924">JSOM in Node.js's context</a> around 5 years ago from now.</p>

<p>Unfortunately, there was no solid solution as a drop-in library. And you could struggle for hours before the "hack" will work for you. And when you needed to switch to a different SharePoint environment with different authentication strategy and your were in trouble.</p>

<p>You might say, how about <a href="https://github.com/vgrem/CSOMNode">CSOMNode</a> project by Vadim Gremyachev, which is already a drop in library ready to use. Well, it's a nice library and it was the inspiration point for me, actually, but it is limited with SAML and Add-in Only authentication strategies and I'm not sure that guys have enough time to support the project with delivering new breaking features. At least the issue asking for NTLM authentication is unanswered for eight months, another issue with authentication also stays untouched. I can understand it as rough time limitations of the author for such side projects.</p>

<p>In my case, I needed the same exact authentication methods which are missed in CSOMNode. On other projects, I use <a href="https://www.npmjs.com/package/node-sp-auth">node-sp-auth</a>, which provides a plenty of different authentication strategies and have a wonderful support from the author.</p>

<p>Also I needed JSOM in Node.js functionality very urgently for one of recent tasks with integration testing.</p>

<p>My first idea was to contribute to CSOMNode and suggest or integrate <code>node-sp-auth</code> by myself and send a Pull Request. After spending some time with the project's code I understood that my PR won't likely be merged soon or at all. I know from my own experience that when an author has an opinion about his approaches, code style, structure, etc., you just can't provide too complex PR and breaking changes even if they are awesome. My changes were going to be such, I mean complex, it's up to you to decide if it's awesome. Also, I have an allergy for writing libraries in pure JavaScript lately and omitting linting rules. But that's my own personal requirement for the code that should be supported later on.</p>

<p>With all these circumstances in mind I started writing my own version of the library for landing JSOM into Node.js context with a variety of authentication mechanisms.</p>

<h2 id="jsominnodejs">JSOM in Node.js</h2>

<p>The algorithm of landing JSOM to Node in general is pretty simple: <br>
- Adjust global Node.js context to pretend to be a browser (<a href="https://github.com/koltyakov/sp-jsom-node/blob/master/src/JsomNode.ts#L75">in code</a>)
- Load and eval JSOM JavaScript files' content in a specific order (<a href="https://github.com/koltyakov/sp-jsom-node/blob/master/src/JsomNode.ts#L142">in code</a>)
- Patch some variables and object to eliminate a couple of issues (e.i. <a href="https://github.com/koltyakov/sp-jsom-node/blob/master/src/JsomNode.ts#L162">microsoft ajax</a>)
- Inject authentication headers into the requests to the server (<a href="https://github.com/koltyakov/sp-jsom-node/blob/master/src/JsomNode.ts#L179">in code</a>)</p>

<p>Mimic browser, loading JSOM JavaScripts and patching variables and object is a trivial part, and mostly had been taken from CSOMNode with some refactoring and conversion to TypeScript. You could check a specific parts in code.</p>

<p>Injecting authentication headers into the requests is really the most complex part.</p>

<p>JavaScript Client Side Object Model uses Microsoft Ajax library and XmlHttpRequest. What can I say?... I don't like their company much.</p>

<p>Initially I planned getting authentication headers and injecting them to all requests in <code>add_executingWebRequest</code> method.</p>

<pre><code class="language-javascript">clientContext.add_executingWebRequest((sender, e) =&gt; {  
    let headers = e.get_webRequest().get_headers();
    for (let header of Object.keys(auth)) {
        if (['Cookie', 'Authorization'].indexOf(header) !== -1) {
            headers[header] = auth[header];
        }
    }
});
</code></pre>

<p>As a result, requests are sent with custom headers.</p>

<p>And it worked... only to FedAuth cookies and Bearer authorization... and didn't for NTLM tokens for example.</p>

<p>The struggle was hard, really hard. I ended up with the idea that I should not use any XmlHttpRequest emulators and wrap my own proxy level into WebRequestManager's <code>executeRequest</code> method.</p>

<p>Original <code>Sys.Net._WebRequestManager.prototype.executeRequest</code> receives web request object and applies it to XmlHttpRequest.</p>

<p>In my <a href="https://github.com/koltyakov/sp-jsom-node/blob/master/src/JsomNode.ts#L179">implementation</a>, Sys.Net._WebRequestManager.prototype.executeRequest is completely rewritten to use <a href="https://www.npmjs.com/package/sp-request">sp-request</a>. It's in charge of injecting auth headers and X-RequestDigest, which works smoothly for almost any kind of auth, including NTML, ADFS and FBA.</p>

<h2 id="usingexamples">Using examples</h2>

<p>Oh, so much lyrics above. Let's start coding JSOM in Node.js without headache.</p>

<p>Let me introduce you <a href="https://github.com/koltyakov/sp-jsom-node"><code>sp-jsom-node</code></a> library, or JsomNode.</p>

<p><img src="https://raw.githubusercontent.com/koltyakov/sp-jsom-node/master/docs/imgs/JsomNode.demo.gif" alt="JsomNode Demo"></p>

<p>First, we need a Node.js project and install the library:</p>

<pre><code class="language-bash">npm install sp-jsom-node --save  
</code></pre>

<p>After <code>sp-jsom-node</code> is installed, it can be used in TypeScript or JavaScript. I'm going to provide all examples in TypeScript and I assume you have TypeScript global modules (like, typescript, ts-node, tslint, etc.) installed.</p>

<p>Next, let's create an index.ts (or any) and paste in the following code snippet:</p>

<pre><code class="language-javascript">import { JsomNode } from 'sp-jsom-node';

(new JsomNode()).wizard().then((settings) =&gt; {

    // Here we are, ready fo JSOM

    const ctx = SP.ClientContext.get_current();
    const oWeb = ctx.get_web();

    ctx.load(oWeb);

    ctx.executeQueryAsync(() =&gt; {
        console.log(oWeb.get_title());
    }, (sender, args) =&gt; {
        console.log(args.get_message());
    });


}).catch(console.log);
</code></pre>

<p>This is the minimal setup without overwhelming configuration.</p>

<p>In this mode, without initial configuration, if we run <code>ts-node ./index.ts</code> we'll be prompted to target to a specific SharePoint site and provide credentials. A subsequent script run re-uses saved configuration parameters and doesn't prompt no more.</p>

<p>If you do not like wizards and prefer manual configuration, no problem:</p>

<pre><code class="language-javascript">import { JsomNode, IJsomNodeSettings } from 'sp-jsom-node';

let settings: any = require('./config/private.json');

let jsomNodeOptions: IJsomNodeSettings = {  
    siteUrl: settings.siteUrl,
    authOptions: {
        ...(settings as any)
    }
};

(new JsomNode(jsomNodeOptions)).init();

/// ... &lt;&lt;&lt; JSOM can be used here
</code></pre>

<p>The project contains integration tests (I test recent libraries with SharePoint Online, SharePoint 2016 and 2013) and example for a quick start which can be downloaded for first experiments with the library.</p>

<h2 id="conclusion">Conclusion</h2>

<p>If you need JSOM in Node.js for any crazy or rational reasons and something prevented you from doing this, welcome on board with <code>sp-jsom-node</code>. And don't forget to comment about your use cases.</p>

<p>I truly hope the library will find its users and that it wasn't developed only for the tasks I needed to be solved.</p>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../../../../author/andrew/" style="background-image: url(../../../../content/images/2016/09/andrew.koltyakov.jpg)"><span class="hidden">Andrew Koltyakov's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../../../../author/andrew/">Andrew Koltyakov</a></h4>

                    <p>SharePoint Front-End Developer</p>
                <div class="author-meta">
                    
                    <span class="author-link icon-link"><a href="http://koltyakov.ru">http://koltyakov.ru</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Using%20JSOM%20(CSOM%2C%20SharePoint%20Client%20Side%20Object%20Model)%20in%20Node.js&amp;url=/2017/06/05/using-jsom-csom-sharepoint-client-side-object-model-in-node-js/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=/2017/06/05/using-jsom-csom-sharepoint-client-side-object-model-in-node-js/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=/2017/06/05/using-jsom-csom-sharepoint-client-side-object-model-in-node-js/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>

        <!-- Comments -->
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "arvo-systems-blog-com";
            (function() {
                var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
                (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
            })();
        </script>
        <!-- Comments -->

    </article>

</main>

<aside class="read-next">
    <a class="read-next-story " style="background-image: url(../../../../content/images/2017/10/sp-build-tasks.jpg)" href="../../../10/04/sharepoint-front-end-projects-automation-and-tasks-tool-belt/">
        <section class="post">
            <h2>SharePoint front-end projects automation and tasks tool-belt</h2>
            <p>I was highly requested to document SharePoint Push &amp; Pull generator projects' build and configuration process and parameters recently.…</p>
        </section>
    </a>
    <a class="read-next-story prev " style="background-image: url(../../../../content/images/2017/05/sp-pnp-node-2.png)" href="../../../05/18/using-pnp-js-core-outside-a-browser-node-js-environment/">
        <section class="post">
            <h2>Using PnP JS Core outside a browser (Node.js environment)</h2>
            <p>Expanding scopes of usage of favorite tools I wrote about PnP JS Core 9 month ago. In those post,…</p>
        </section>
    </a>
</aside>



        </div>
    </div>

    <div id="footer" class="bg-dark fg-white">
        <div class="container">
            <div class="brands">
                <div class="padding10 footer-element">
                <img class="sh" src="/assets/images/o365_nm_ft_i.png?v=7b8d2b4800" style="display: none;">
                <img class="fl" src="/assets/images/o365_nm_ft.png?v=7b8d2b4800">
                </div>
                <div class="padding10 footer-element">
                <img class="sh" src="/assets/images/sp_nm_ft_i.png?v=7b8d2b4800" style="display: none;">
                <img class="fl" src="/assets/images/sp_nm_ft.png?v=7b8d2b4800">
                </div>
                <div class="padding10 footer-element">
                <img class="sh" src="/assets/images/msp_nm_ft_i.png?v=7b8d2b4800" style="display: none;">
                <img class="fl" src="/assets/images/msp_nm_ft.png?v=7b8d2b4800">
                </div>		
            </div>
            <div class="copyright">
                <div class="padding10 footer-element">
                <img src="/assets/images/arvo_nm_ft.png?v=7b8d2b4800">
                </div>    
                <div class="padding10 footer-element copy-text">© 2016<br>
                <small>All rights reserved</small>
                </div> 
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js?v=7b8d2b4800"></script>
    <script type="text/javascript" src="/assets/js/index.js?v=7b8d2b4800"></script>
    <script type="text/javascript" src="/assets/js/prism.js?v=7b8d2b4800"></script>

    <!-- Piwik -->
    <script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["setDomains", ["*.arvosys.com","*.blog.arvosys.com","*.www.arvosys.com","*.blog.arvosys.com"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//piwik.spflow.com/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '9']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
    </script>
    <noscript><p><img src="http://piwik.spflow.com/piwik.php?idsite=9" style="border:0;" alt=""></p></noscript>
    <!-- End Piwik Code -->

</body>
