
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>SharePoint .Net authentication via embedded Node.js</title>
    <meta name="description" content="">

    <meta name="google-site-verification" content="kj4x9HBApwneuGIIlFZj11VGEQnPG5Mp21U2n_mSCcU">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/assets/images/favicon.ico?v=7b8d2b4800">

    <link rel="stylesheet" type="text/css" href="/assets/css/arvo-bundle.css?v=7b8d2b4800">
    <link rel="stylesheet" type="text/css" href="/assets/css/prism.css?v=7b8d2b4800">
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=7b8d2b4800">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="ARVO Systems Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="SharePoint .Net authentication via embedded Node.js">
    <meta property="og:description" content="Intro I'm a fan of crazy experiments with technologies and code. How many times I catch myself on saying &quot;Why don't to [insane idea to implement]&quot;, then in one grasp after a while seating and scratching my head with &quot;Oh shoot! It's working! O_o&quot;. That's how some of my">
    <meta property="og:url" content="/2017/10/30/sharepoint-net-authentication-via-embedded-node-js/">
    <meta property="og:image" content="/content/images/2017/10/PimpMyDonNetWithNode-2.png">
    <meta property="article:published_time" content="2017-10-29T23:05:08.000Z">
    <meta property="article:modified_time" content="2017-10-29T23:18:05.000Z">
    <meta property="article:tag" content="SharePoint">
    <meta property="article:tag" content="Node.js">
    <meta property="article:tag" content="API">
    <meta property="article:tag" content="development">
    <meta property="article:tag" content=".Net">
    <meta property="article:tag" content="Authentication">
    
    <meta property="article:author" content="https://www.facebook.com/andrew.koltyakov">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SharePoint .Net authentication via embedded Node.js">
    <meta name="twitter:description" content="Intro I'm a fan of crazy experiments with technologies and code. How many times I catch myself on saying &quot;Why don't to [insane idea to implement]&quot;, then in one grasp after a while seating and scratching my head with &quot;Oh shoot! It's working! O_o&quot;. That's how some of my">
    <meta name="twitter:url" content="/2017/10/30/sharepoint-net-authentication-via-embedded-node-js/">
    <meta name="twitter:image" content="/content/images/2017/10/PimpMyDonNetWithNode-2.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Andrew Koltyakov">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="SharePoint, Node.js, API, development, .Net, Authentication">
    <meta name="twitter:creator" content="@AndrewKoltyakov">
    <meta property="og:image:width" content="1920">
    <meta property="og:image:height" content="322">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "ARVO Systems Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "/content/images/2016/09/arvo_logo_105px.png",
            "width": 105,
            "height": 42
        }
    },
    "author": {
        "@type": "Person",
        "name": "Andrew Koltyakov",
        "image": {
            "@type": "ImageObject",
            "url": "/content/images/2016/09/andrew.koltyakov.jpg",
            "width": 460,
            "height": 460
        },
        "url": "/author/andrew/",
        "sameAs": [
            "http://koltyakov.ru",
            "https://www.facebook.com/andrew.koltyakov",
            "https://twitter.com/AndrewKoltyakov"
        ],
        "description": "SharePoint Front-End Developer"
    },
    "headline": "SharePoint .Net authentication via embedded Node.js",
    "url": "/2017/10/30/sharepoint-net-authentication-via-embedded-node-js/",
    "datePublished": "2017-10-29T23:05:08.000Z",
    "dateModified": "2017-10-29T23:18:05.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "/content/images/2017/10/PimpMyDonNetWithNode-2.png",
        "width": 1920,
        "height": 322
    },
    "keywords": "SharePoint, Node.js, API, development, .Net, Authentication",
    "description": "Intro I&#x27;m a fan of crazy experiments with technologies and code. How many times I catch myself on saying &quot;Why don&#x27;t to [insane idea to implement]&quot;, then in one grasp after a while seating and scratching my head with &quot;Oh shoot! It&#x27;s working! O_o&quot;. That&#x27;s how some of my",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://external.arvosys.com:2368"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.10">
    <link rel="alternate" type="application/rss+xml" title="ARVO Systems Blog" href="../../../../rss/index.html">
</head>
<body class="post-template tag-sharepoint tag-node-js tag-api tag-development tag-net tag-authentication nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-blog-home" role="presentation"><a href="../../../../">Blog Home</a></li>
            <li class="nav-search" role="presentation"><a href="http://www.arvosys.com/search/">Search</a></li>
            <li class="nav-arvo-systems" role="presentation"><a href="http://www.arvosys.com/">ARVO Systems</a></li>
            <li class="nav--services" role="presentation"><a href="http://www.arvosys.com/services/">... Services</a></li>
            <li class="nav--platforms" role="presentation"><a href="http://www.arvosys.com/platforms/">... Platforms</a></li>
            <li class="nav--contacts" role="presentation"><a href="http://www.arvosys.com/about/contacts/">... Contacts</a></li>
    </ul>
        <a class="subscribe-button icon-feed" href="../../../../rss/index.rss">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">
        <div id="content-wrapper" class="page-content">

            


<header class="main-header post-head " style="background-image: url(../../../../content/images/2017/10/PimpMyDonNetWithNode-2.png)">
    <nav class="main-nav overlay clearfix">
        <a class="blog-logo" href="../../../../"><img src="../../../../content/images/2016/09/arvo_logo_105px.png" alt="ARVO Systems Blog"></a>
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-sharepoint tag-node-js tag-api tag-development tag-net tag-authentication">

        <header class="post-header">
            <h1 class="post-title">SharePoint .Net authentication via embedded Node.js</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-10-30">30 October 2017</time>  on <a href="../../../../tag/sharepoint/">SharePoint</a>, <a href="../../../../tag/node-js/">Node.js</a>, <a href="../../../../tag/api/">API</a>, <a href="../../../../tag/development/">development</a>, <a href="../../../../tag/net/">.Net</a>, <a href="../../../../tag/authentication/">Authentication</a>
            </section>
        </header>

        <section class="post-content">
            <h2 id="intro">Intro</h2>

<p>I'm a fan of crazy experiments with technologies and code. How many times I catch myself on saying "Why don't to [insane idea to implement]", then in one grasp after a while seating and scratching my head with "Oh shoot! It's working! O_o". That's how some of my open source projects saw the light.</p>

<p>Last week there was the idea to dig <a href="https://github.com/tjanczuk/edge">Edge.js</a> a bit. Edge.js is a library which allows running CLR languages like C# .Net from Node.js and vice versa.</p>

<p>For a while, we had a plan of syncing <code>sp-cmd-deploy</code> (.Net module for getting CSOM context) with <code>node-sp-auth-config</code> (Node.js module for a work with auth). Both modules have some common ideas. And it would have been great to share some settings between them.</p>

<p>Jungling these ideas somebody said "Why don't we just use <code>node-sp-auth-conf</code> in our .Net apps too?". <br>
Well... said and done!</p>

<h2 id="spauthnhttpsgithubcomkoltyakovspauthn"><a href="https://github.com/koltyakov/SPAuthN">SPAuthN</a></h2>

<p>Here our pet Frankenstein <code>SPAuthN</code>. <br>
SPAuthN is a .Net library available in NuGets. And it's a wrapper for <a href="https://www.npmjs.com/package/node-sp-auth">node-sp-auth</a> and <a href="https://www.npmjs.com/package/node-sp-auth-config">node-sp-auth-config</a>. <br>
This monster allows authenticating in SharePoint in whatever you need scenarios and provides a wizard-like approach for building and managing connection config files.</p>

<h2 id="disclaimer">Disclaimer</h2>

<p>Before reading further, attention, please! On the first place, it is a crazy experiment which solves one of our very specific tasks for a frontier technology stack with SharePoint, Node.js and .Net where we need running the same exactly auth mechanisms which we use in Node.js but in .Net applications. We know exactly what we're doing and why. Please use the lib only in the case when native .Net credentials strategies do not suite your app.</p>

<h2 id="forwhomisthislibrary">For whom is this library?</h2>

<p>For folks who used to create applications for SharePoint with authentication level powered by node-sp-auth-config and node-sp-auth-config and who desire reuse authentication settings parameters and formats in .Net application.</p>

<p>For geeks from geeks passionated with funky technology experiments on their way doing awesome stuff.</p>

<p>For the cases when one tool should rule *all possible authentication strategies in SharePoint.</p>

<p>And definitely not for the situations when these work for you:</p>

<ul>
<li>context.Credentials = new SharePointOnlineCredentials("username", "securepass");</li>
<li>context.Credentials = new NetworkCredential("username", "password", "domain");</li>
<li>Any other native authentication routes.</li>
</ul>

<h2 id="features">Features</h2>

<p>SPAuthN supports authenticating against SharePoint Online, 2016, 2013. <br>
It's one ring to rule Addin only permissions, SAML based with user credentials, ADFS user credentials, User credentials through the http NTLM handshake, ADFS user credentials, Form-based (FBA), Forefront TMG authentication strategies.</p>

<h2 id="howitworksinanutshell">How it works in a nutshell</h2>

<ul>
<li>Edge.js's Func wraps some Node.js scripts with wizard, authentication, and utilities</li>
<li>Edge.js provides embedded runtime for server-side JavaScript</li>
<li>Script utilities check and install node module dependencies with <code>node-sp-auth</code> and others</li>
<li>Execution is passed to JS side when done option results are passed back to managed code</li>
<li>Result object contains auth headers which can be injected to HTTP requests and viola!</li>
</ul>

<h2 id="howtouse">How to use</h2>

<pre><code class="language-csharp">Options options = SPAuth.GetAuth();  
</code></pre>

<p>That's it! Really!</p>

<p>Now <code>options.headers</code> object contains Cookie or Authorization which can be injected to web requests. <br>
This is a low level, session timeouts should be controlled manually.</p>

<h2 id="firstrun">First run</h2>

<p>During very first execution, node modules dependencies are installed. This can take a couple of seconds, second run doesn't need this process repetition so is much faster.</p>

<h2 id="credentials">Credentials</h2>

<p><a href="https://github.com/koltyakov/node-sp-auth-config">node-sp-auth-config</a> is responsible for prompting auth strategy and credentials:</p>

<p><img src="../../../../content/images/2017/10/auth-wizard.gif" alt=""></p>

<p>By default, after the prompts are done <code>./config/private.json</code> file is created in the root folder of the app.</p>

<p><img src="../../../../content/images/2017/10/private-json.png" alt=""></p>

<p><code>GetAuth</code> checks for <code>./config/private.json</code> and continues without prompts if all needed for the strategy parameters are filled in.
The password is stored as a secure string, it can be used only on the machine where it was generated. The password can be rewritten in the config and it will be encrypted on next auth method run.</p>

<h2 id="arguments">Arguments</h2>

<p><code>GetAuth</code> method receives a string with arguments which are passed as initiators to <a href="https://github.com/koltyakov/node-sp-auth-config/blob/master/src/interfaces/index.ts#L35">AuthConfigSettings</a>.</p>

<pre><code class="language-csharp">Options options = SPAuth.GetAuth("--encryptPassword=false --configPath='./config/private.uat.json'");  
</code></pre>

<h3 id="argumentsusecases">Arguments use cases</h3>

<h4 id="redefineprivateconfigfilepath">Redefine private config file path</h4>

<pre><code class="language-bash">--configPath='./config/private.prod.json'
</code></pre>

<h4 id="disablepasswordencryption">Disable password encryption</h4>

<pre><code class="language-bash">--encryptPassword=false
</code></pre>

<h4 id="disablesavingprivateconfigondisc">Disable saving private config on disc</h4>

<pre><code class="language-bash">--saveConfigOnDisk=false
</code></pre>

<h4 id="enforceparametersprompts">Enforce parameters prompts</h4>

<pre><code class="language-bash">--forcePrompts=true
</code></pre>

<h4 id="rawauthoptionsexample">Raw auth options (example)</h4>

<pre><code class="language-bash">--authOptions.siteUrl="http://sharepoint" --authOptions.username="user@contoso.com" --authOptions.password="p@ssw0rd" --saveConfigOnDisk=false
</code></pre>

<h3 id="usageexamples">Usage examples</h3>

<h4 id="webrequest">WebRequest</h4>

<pre><code class="language-csharp">Options options = SPAuth.GetAuth("--configPath='./config/private.json'");  
WebRequest request = WebRequest.Create(options.SiteUrl + "/_api/web?$select=Title");  
request.Headers = options.Headers;  
HttpWebResponse response = (HttpWebResponse)request.GetResponse();  
if (response.StatusCode == HttpStatusCode.OK || response.StatusCode == HttpStatusCode.NoContent)  
{
  Stream dataStream = response.GetResponseStream();
  XDocument xDoc = XDocument.Load(dataStream);

  XNamespace ns = "http://www.w3.org/2005/Atom";
  XNamespace d = "http://schemas.microsoft.com/ado/2007/08/dataservices";
  XNamespace m = "http://schemas.microsoft.com/ado/2007/08/dataservices/metadata";

  string title = xDoc
    .Element(ns + "entry").Element(ns + "content")
    .Element(m + "properties").Element(d + "Title").Value;

  Console.WriteLine("REST | Web title is: {0}", title);
  dataStream.Close();
}
response.Close();  
</code></pre>

<h4 id="csom">CSOM</h4>

<pre><code class="language-csharp">Options options = SPAuth.GetAuth("--configPath='./config/private.json'");  
using (ClientContext clientContext = new ClientContext(options.SiteUrl))  
{
  clientContext.ExecutingWebRequest += (sender, arguments) =&gt;
  {
    foreach (var key in options.Headers.AllKeys)
    {
      arguments.WebRequestExecutor.RequestHeaders[key] = options.Headers[key];
    }
  };

  var web = clientContext.Web;
  clientContext.Load(web);
  clientContext.ExecuteQuery();

  Console.WriteLine("CSOM | Web title is: {0}", web.Title);
}
</code></pre>

<h2 id="afterwords">Afterwords</h2>

<p>Please don't understand me wrong. I know that it's a crazy stuff, but at the same time, it's an interesting example of reusing code base from absolutely different worlds and stacks and integrating one thing into another.</p>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../../../../author/andrew/" style="background-image: url(../../../../content/images/2016/09/andrew.koltyakov.jpg)"><span class="hidden">Andrew Koltyakov's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../../../../author/andrew/">Andrew Koltyakov</a></h4>

                    <p>SharePoint Front-End Developer</p>
                <div class="author-meta">
                    
                    <span class="author-link icon-link"><a href="http://koltyakov.ru">http://koltyakov.ru</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=SharePoint%20.Net%20authentication%20via%20embedded%20Node.js&amp;url=/2017/10/30/sharepoint-net-authentication-via-embedded-node-js/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=/2017/10/30/sharepoint-net-authentication-via-embedded-node-js/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=/2017/10/30/sharepoint-net-authentication-via-embedded-node-js/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>

        <!-- Comments -->
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "arvo-systems-blog-com";
            (function() {
                var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
                (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
            })();
        </script>
        <!-- Comments -->

    </article>

</main>

<aside class="read-next">
    <a class="read-next-story prev " style="background-image: url(../../../../content/images/2017/10/ReactPlusProxy1.jpg)" href="../../29/getting-started-with-react-local-development-for-sharepoint-with-sp-rest-proxy/">
        <section class="post">
            <h2>Getting started with React local development for SharePoint with sp-rest-proxy</h2>
            <p>Intro React is a beloved library of many folks which allows building modular reusable user interfaces and applications.  As…</p>
        </section>
    </a>
</aside>



        </div>
    </div>

    <div id="footer" class="bg-dark fg-white">
        <div class="container">
            <div class="brands">
                <div class="padding10 footer-element">
                <img class="sh" src="/assets/images/o365_nm_ft_i.png?v=7b8d2b4800" style="display: none;">
                <img class="fl" src="/assets/images/o365_nm_ft.png?v=7b8d2b4800">
                </div>
                <div class="padding10 footer-element">
                <img class="sh" src="/assets/images/sp_nm_ft_i.png?v=7b8d2b4800" style="display: none;">
                <img class="fl" src="/assets/images/sp_nm_ft.png?v=7b8d2b4800">
                </div>
                <div class="padding10 footer-element">
                <img class="sh" src="/assets/images/msp_nm_ft_i.png?v=7b8d2b4800" style="display: none;">
                <img class="fl" src="/assets/images/msp_nm_ft.png?v=7b8d2b4800">
                </div>		
            </div>
            <div class="copyright">
                <div class="padding10 footer-element">
                <img src="/assets/images/arvo_nm_ft.png?v=7b8d2b4800">
                </div>    
                <div class="padding10 footer-element copy-text">© 2016<br>
                <small>All rights reserved</small>
                </div> 
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js?v=7b8d2b4800"></script>
    <script type="text/javascript" src="/assets/js/index.js?v=7b8d2b4800"></script>
    <script type="text/javascript" src="/assets/js/prism.js?v=7b8d2b4800"></script>

    <!-- Piwik -->
    <script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["setDomains", ["*.arvosys.com","*.blog.arvosys.com","*.www.arvosys.com","*.blog.arvosys.com"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//piwik.spflow.com/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '9']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
    </script>
    <noscript><p><img src="http://piwik.spflow.com/piwik.php?idsite=9" style="border:0;" alt=""></p></noscript>
    <!-- End Piwik Code -->

</body>
